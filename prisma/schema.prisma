generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth", "public"]
}

model User {
  id               String       @id @default(cuid())
  email            String       @unique
  name             String?
  role             String       @default("user")
  banned           Boolean      @default(false)
  banReason        String?
  banExpires       DateTime?
  emailVerified    Boolean?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  image            String?
  emergencyContact Json?
  phone            String?
  userType         UserType?
  magicLinks       MagicLink[]
  accounts         Account[]
  invitations      Invitation[]
  members          Member[]
  sessions         Session[]
  Parent           Parent?
  responses        Response[]
  Student          Student?
  Teacher          Teacher?

  @@map("user")
  @@schema("auth")
}

model Session {
  id                   String   @id @default(cuid())
  userId               String
  expiresAt            DateTime
  token                String   @unique
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  ipAddress            String?
  userAgent            String?
  impersonatedBy       String?
  activeOrganizationId String?
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
  @@schema("auth")
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@map("account")
  @@schema("auth")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
  @@map("verification")
  @@schema("auth")
}

model MagicLink {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  email     String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@schema("auth")
}

model Organization {
  id            String       @id @default(cuid())
  name          String
  slug          String       @unique
  logo          String?
  metadata      Json?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  address       String?
  capacity      Int?
  location      String?
  phone         String?
  principalName String?
  invitations   Invitation[]
  members       Member[]
  Classroom     Classroom[]
  Student       Student[]
  Teacher       Teacher[]
  quiz          quiz[]

  @@map("organization")
  @@schema("auth")
}

model Member {
  id             String       @id @default(cuid())
  userId         String
  organizationId String
  role           String       @default("member")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@map("member")
  @@schema("auth")
}

model Invitation {
  id             String       @id @default(cuid())
  organizationId String
  email          String
  role           String       @default("member")
  inviterId      String
  token          String       @unique
  status         String       @default("pending")
  expiresAt      DateTime
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  inviter        User         @relation(fields: [inviterId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([email, organizationId])
  @@map("invitation")
  @@schema("auth")
}

model Profile {
  id          String   @id @default(cuid())
  userId      String   @unique
  preferences Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@schema("public")
}

model Question {
  id            String   @id @default(cuid())
  quizId        String
  question      String
  options       String[]
  correctAnswer String
  order         Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  quiz          quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@schema("public")
}

model Response {
  id          String   @id @default(cuid())
  quizId      String
  userId      String
  answers     Json
  score       Float?
  completedAt DateTime @default(now())
  quiz        quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@schema("public")
}

model Password {
  id        String   @id @default(cuid())
  length    Int
  hash      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@schema("public")
}

model Announcement {
  id             String         @id
  title          String
  content        String
  authorId       String
  campusId       String
  targetAudience TargetAudience
  classroomId    String?
  grade          String?
  isPinned       Boolean        @default(false)
  publishedAt    DateTime       @default(now())
  createdAt      DateTime       @default(now())
  updatedAt      DateTime

  @@schema("public")
}

model AttendanceRecord {
  id                String            @id
  sessionId         String
  studentId         String
  status            AttendanceStatus
  notes             String?
  createdAt         DateTime          @default(now())
  AttendanceSession AttendanceSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, studentId])
  @@schema("public")
}

model AttendanceSession {
  id               String             @id
  classroomId      String
  date             DateTime
  campusId         String
  markedById       String
  createdAt        DateTime           @default(now())
  AttendanceRecord AttendanceRecord[]

  @@schema("public")
}

model CafeteriaMenu {
  id            String    @id
  weekStartDate DateTime
  dayOfWeek     DayOfWeek
  menuItems     Json
  specialNotes  String?
  campusId      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime

  @@unique([campusId, weekStartDate, dayOfWeek])
  @@schema("public")
}

model CalendarEvent {
  id             String    @id
  title          String
  description    String?
  eventType      EventType
  startDate      DateTime
  endDate        DateTime?
  campusId       String
  isSchoolClosed Boolean   @default(false)
  createdById    String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime

  @@schema("public")
}

model Classroom {
  id                  String                @id
  name                String
  grade               String
  subject             String
  campusId            String
  teacherId           String
  capacity            Int?
  room                String?
  schedule            Json?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  organization        Organization          @relation(fields: [campusId], references: [id], onDelete: Cascade)
  Teacher             Teacher               @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  ClassroomEnrollment ClassroomEnrollment[]

  @@schema("public")
}

model ClassroomEnrollment {
  id          String    @id
  classroomId String
  studentId   String
  enrolledAt  DateTime  @default(now())
  Classroom   Classroom @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  Student     Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([classroomId, studentId])
  @@schema("public")
}

model Grade {
  id            String   @id
  studentId     String
  classroomId   String
  subject       String
  grade         String
  gradingPeriod String
  teacherId     String
  comments      String?
  campusId      String
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@schema("public")
}

model Message {
  id             String   @id
  senderId       String
  recipientId    String
  subject        String
  content        String
  conversationId String
  isRead         Boolean  @default(false)
  campusId       String
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@schema("public")
}

model Parent {
  id             String          @id
  userId         String          @unique
  primaryContact Boolean         @default(false)
  relationship   String
  occupation     String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  StudentParent  StudentParent[]

  @@schema("public")
}

model Student {
  id                  String                @id
  userId              String                @unique
  grade               String
  enrollmentDate      DateTime              @default(now())
  campusId            String
  authorizedPickups   Json?
  medicalInfo         Json?
  photoUrl            String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  ClassroomEnrollment ClassroomEnrollment[]
  organization        Organization          @relation(fields: [campusId], references: [id], onDelete: Cascade)
  user                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  StudentParent       StudentParent[]

  @@schema("public")
}

model StudentParent {
  id        String   @id
  studentId String
  parentId  String
  createdAt DateTime @default(now())
  Parent    Parent   @relation(fields: [parentId], references: [id], onDelete: Cascade)
  Student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, parentId])
  @@schema("public")
}

model Teacher {
  id             String       @id
  userId         String       @unique
  certifications String[]
  subjects       String[]
  employeeId     String?      @unique
  cvUrl          String?
  campusId       String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  Classroom      Classroom[]
  organization   Organization @relation(fields: [campusId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@schema("public")
}

model quiz {
  id             String       @id
  title          String
  description    String?
  organizationId String
  createdBy      String
  subject        String?
  gradeLevel     String?
  classroomId    String?
  assignedTo     String[]
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  questions      Question[]
  responses      Response[]
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@schema("public")
}

enum UserType {
  Teacher
  Parent
  Student
  Admin

  @@schema("auth")
}

enum AttendanceStatus {
  Present
  Absent
  Late

  @@schema("public")
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday

  @@schema("public")
}

enum EventType {
  Holiday
  ParentTeacherConference
  Assembly
  FieldTrip
  ExamPeriod
  Other

  @@schema("public")
}

enum TargetAudience {
  AllParents
  AllTeachers
  Classroom
  Grade

  @@schema("public")
}
